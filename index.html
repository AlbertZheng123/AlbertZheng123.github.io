<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Anniversary Jeopardy ðŸ’—</title>
  <style>
    :root{
      --bg:#fff7fb;
      --panel:#ffffffcc;
      --border:#ffd3e6;
      --pink:#ff7fb4;
      --pink2:#ffb6d5;
      --text:#2b2b2b;
      --muted:#6d5b66;
      --tile:#ffe6f1;
      --tile2:#ffd3e6;
      --ok:#26b36b;
      --bad:#e14b6a;
      --shadow:0 18px 60px rgba(255,127,180,.18);
    }
    *{box-sizing:border-box}
    body{
      margin:0; min-height:100vh;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background:
        radial-gradient(circle at top, #ffe1ef 0%, var(--bg) 55%),
        radial-gradient(circle at bottom, #ffeaf4 0%, var(--bg) 65%);
      color: var(--text);
      display:flex; flex-direction:column;
    }
    header{
  padding:16px 16px 12px;
  display:grid;
  grid-template-columns: 1fr auto 1fr; /* left spacer | title | score */
  align-items:center;
  gap:12px;
  border-bottom:1px solid var(--border);
  background:var(--panel);
  backdrop-filter: blur(10px);
}

.title{
  grid-column: 2;
  text-align:center;
  display:flex;
  flex-direction:column;
  gap:4px;
  padding: 6px 14px;
  border-radius: 18px;
  border: 1px solid rgba(255, 179, 213, .65);
  background: linear-gradient(180deg, #ffffff, #fff2f8);
  box-shadow: 0 10px 30px rgba(255,127,180,.12);
}

.title h1{
  margin:0;
  font-size: clamp(20px, 3.2vw, 28px);
  letter-spacing:.4px;
  color:#c2185b;
  font-weight: 950;
}

.title p{
  margin:0;
  color:var(--muted);
  font-size:13px;
  font-weight: 750;
}


    .scorebar{
  grid-column: 3;
  justify-self:end;
}

    .score{font-weight:900; font-size:16px; color:#c2185b}
    .btn{
      border:1px solid var(--border);
      cursor:pointer;
      padding:10px 12px;
      border-radius:14px;
      font-weight:800;
      background:#fff;
      color:var(--text);
      transition: transform .12s ease, background .12s ease, box-shadow .12s ease;
      box-shadow:0 8px 20px rgba(255,127,180,.10);
    }
    .btn:hover{transform: translateY(-1px); background:#fff5fa;}
    .btn.small{padding:8px 10px; font-size:13px}
    .btn.reset{border-color:#ffd3e6;}
    .btn.primary{background:#fff5fa; border-color:#ffb6d5;}
    .btn.correct{border-color: rgba(38,179,107,.35); background: rgba(38,179,107,.10);}
    .btn.wrong{border-color: rgba(225,75,106,.35); background: rgba(225,75,106,.10);}

    main{
      padding:16px;
      width:min(1100px, 98vw);
      margin:0 auto;
      flex:1;
      display:flex;
      flex-direction:column;
      gap:14px;
    }
    .hint{
      color:var(--muted);
      font-size:13px;
      display:flex; align-items:center; justify-content:space-between;
      gap:10px; flex-wrap:wrap;
      padding:10px 12px;
      border:1px dashed #ffb6d5;
      border-radius:16px;
      background:#ffffffb5;
    }

    .board{
      display:grid;
      grid-template-columns: repeat(5, 1fr);
      gap:10px;
    }
    .cat{
      background: linear-gradient(180deg, #fff, #fff5fa);
      border:1px solid var(--border);
      border-radius:16px;
      padding:12px 10px;
      text-align:center;
      font-weight:900;
      text-transform: uppercase;
      letter-spacing:.7px;
      font-size:12px;
      min-height:58px;
      display:flex; align-items:center; justify-content:center;
      color:#c2185b;
      box-shadow:0 10px 30px rgba(255,127,180,.10);
    }
    .tile{
      background: linear-gradient(180deg, var(--tile), var(--tile2));
      border:1px solid #ffb6d5;
      border-radius:16px;
      padding:16px 10px;
      min-height:70px;
      display:grid; place-items:center;
      font-weight:950;
      font-size:22px;
      color:#c2185b;
      cursor:pointer;
      user-select:none;
      box-shadow:var(--shadow);
      transition: transform .12s ease, filter .12s ease, opacity .12s ease;
    }
    .tile:hover{transform: translateY(-2px); filter: brightness(1.03)}
    .tile.used{cursor:not-allowed; opacity:.40; filter: grayscale(.35); transform:none !important;}

    /* Modal */
    .overlay{
      position:fixed; inset:0;
      background: rgba(255,140,190,.35);
      display:none;
      align-items:center; justify-content:center;
      padding:18px;
    }
    .overlay.show{display:flex;}
    .modal{
      max-height: 88vh;
      overflow-y: auto;
      width:min(900px, 96vw);
      border-radius:18px;
      background:#fff;
      border:1px solid var(--border);
      box-shadow:0 30px 120px rgba(194,24,91,.18);
      padding:18px;
      display:flex; flex-direction:column; gap:12px;
    }
    .modalhead{display:flex; justify-content:space-between; gap:10px; align-items:flex-start;}
    .meta{display:flex; flex-direction:column; gap:2px}
    .meta .label{color:var(--muted); font-size:12px; letter-spacing:.3px}
    .meta .big{font-size:18px; font-weight:950; color:#c2185b}
    .close{
      background:#fff;
      border:1px solid var(--border);
      color:var(--text);
      border-radius:12px;
      padding:8px 10px;
      cursor:pointer;
      font-weight:800;
    }

    .clue{
  padding:16px;
  border-radius:16px;
  background:#fff7fb;
  border:1px solid var(--border);
  font-size:18px;
  line-height:1.5;

  max-height: 22vh;     /* âœ… limits height */
  overflow-y: auto;     /* âœ… scrolls if long */
}


    .clueImg{
  display:none;
  width:100%;
  max-height:420px;
  object-fit:contain;          /* âœ… no cropping */
  border-radius:16px;
  border:1px solid var(--border);
  background:#fff7fb;          /* shows behind empty space */
}


    .mcArea, .typeArea, .answerBox{
      padding:14px;
      border-radius:16px;
      background:#ffffff;
      border:1px solid var(--border);
      display:flex;
      flex-direction:column;
      gap:10px;
    }

    .choices{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
    }

    .choiceBtn{
      display:flex;
      gap:12px;
      align-items:center;
      text-align:left;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid var(--border);
      background:#fff;
      cursor:pointer;
      font-weight:800;
      transition: transform .10s ease, background .10s ease, box-shadow .10s ease;
      box-shadow:0 8px 20px rgba(255,127,180,.10);
    }
    .choiceBtn:hover{transform: translateY(-1px); background:#fff5fa;}
    .choiceBtn:disabled{cursor:not-allowed; opacity:.85; transform:none;}
    .choiceBtn.correct{border-color: rgba(38,179,107,.35); background: rgba(38,179,107,.10);}
    .choiceBtn.wrong{border-color: rgba(225,75,106,.35); background: rgba(225,75,106,.10);}

    .choiceThumb{
  width:72px;
  height:54px;
  object-fit:contain;          /* âœ… no cropping */
  border-radius:12px;
  border:1px solid var(--border);
  flex:0 0 auto;
  background:#fff7fb;
}


    .typeRow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }
    input[type="text"]{
      flex:1;
      min-width:220px;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid var(--border);
      outline:none;
      font-size:15px;
    }
    input[type="text"]:focus{
      border-color:#ff7fb4;
      box-shadow:0 0 0 4px rgba(255,127,180,.15);
    }

    .result{
      display:none;
      padding:12px 14px;
      border-radius:14px;
      border:1px solid var(--border);
      background:#fff7fb;
      font-weight:850;
    }
    .result.show{display:block;}
    .result.ok{border-color: rgba(38,179,107,.35); background: rgba(38,179,107,.10);}
    .result.bad{border-color: rgba(225,75,106,.35); background: rgba(225,75,106,.10);}

    .answerBox{
  display:none;
  max-height: 38vh;     /* âœ… scroll if long */
  overflow-y: auto;     /* âœ… */
  padding:14px;
  border-radius:16px;
  background:#ffffff;
  border:1px solid var(--border);
  gap:10px;
}
.answerBox.show{display:flex;}

    .answerTitle{
      font-weight:950;
      color:#c2185b;
      letter-spacing:.2px;
    }
    .answerContent{
      line-height:1.55;
      font-weight:750;
      color:#8a2450;
      white-space:pre-wrap;
    }
    .answerImg{
  display:none;
  width:100%;
  max-height:520px;
  object-fit:contain;          /* âœ… no cropping */
  border-radius:16px;
  border:1px solid var(--border);
  background:#fff7fb;
}
    .answerPopupBody{
  max-height: 70vh;     /* âœ… scroll area */
  overflow-y: auto;     /* âœ… */
  padding: 6px 2px;     /* small spacing */
}

/* ensure images never crop */
.answerImg{
  display:none;
  width:100%;
  max-height:520px;
  object-fit:contain;
  border-radius:16px;
  border:1px solid var(--border);
  background:#fff7fb;
}



    .actions{
      display:flex; gap:10px; flex-wrap:wrap; justify-content:space-between; align-items:center;
    }
    .leftActions,.rightActions{display:flex; gap:10px; flex-wrap:wrap}

    @media (max-width: 820px){
      .board{grid-template-columns: repeat(2, 1fr);}
      .cat{min-height:52px;}
      .choiceThumb{width:64px; height:48px;}
    }
  </style>
</head>
<body>
  <header>
    <div class="title">
      <h1>Anniversary Jeopardy ðŸ’—</h1>
      <p>For Talitha â€¢ Baby pink edition</p>
    </div>

    <div class="scorebar">
      <div>Score: <span class="score" id="score">$0</span></div>
      <button class="btn small reset" id="resetBtn">Reset</button>
    </div>
  </header>

  <main>
    <div class="hint">
      <div>Click a tile, answer, then enjoy the little memory box ðŸ’•</div>
      <div>Used: <span id="usedCount">0</span> / <span id="totalCount">25</span></div>
    </div>

    <div class="board" id="board"></div>
  </main>

  <!-- Modal -->
  <div class="overlay" id="overlay">
    <div class="modal" role="dialog" aria-modal="true">
      <div class="modalhead">
        <div class="meta">
          <div class="label" id="metaLabel">Category â€¢ $Value</div>
          <div class="big" id="metaTitle">Clue</div>
        </div>
        <button class="close" id="closeBtn">Close</button>
      </div>

      <img id="clueImg" class="clueImg" alt="Clue image" />

      <div class="clue" id="clueText"></div>

      <!-- Multiple choice area (100/200/300) -->
      <div class="mcArea" id="mcArea" style="display:none;">
        <div class="choices" id="choices"></div>
        <div class="result" id="mcResult"></div>
      </div>

      <!-- Typed response area (400/500) -->
      <div class="typeArea" id="typeArea" style="display:none;">
        <div class="typeRow">
          <input id="typedInput" type="text" placeholder="Type your answer..." autocomplete="off" />
          <button class="btn primary" id="checkTypedBtn">Check</button>
        </div>
        <div class="result" id="typeResult"></div>
      </div>

      <!-- Answer box (appears AFTER answering/checking) -->


      <div class="actions">
        <div class="leftActions">
          <button class="btn" id="skipBtn">Back to Board</button>
        </div>
        <div class="rightActions">
          <button class="btn wrong" id="wrongBtn">Wrong (-$)</button>
          <button class="btn correct" id="correctBtn">Correct (+$)</button>
        </div>
      </div>
    </div>
  </div>
  <!-- Answer Popup (separate modal) -->
<div class="overlay" id="answerOverlay" style="display:none;">
  <div class="modal" role="dialog" aria-modal="true" style="width:min(900px, 96vw);">
    <div class="modalhead">
      <div class="meta">
        <div class="label" id="answerMetaLabel">Answer â€¢ Memory</div>
        <div class="big" id="answerMetaTitle">ðŸ’—</div>
      </div>
      <button class="close" id="answerCloseBtn">Close</button>
    </div>

    <div class="answerPopupBody" id="answerPopupBody">
      <div class="answerTitle" id="answerPopupTitle">Answer ðŸ’—</div>
      <div class="answerContent" id="answerPopupText"></div>
      <img id="answerPopupImg" class="answerImg" alt="Answer image" />
    </div>

    <div class="actions">
      <div class="leftActions">
        <button class="btn primary" id="answerBackBtn">Back to Board</button>
      </div>
      <div class="rightActions">
        <button class="btn" id="answerStayBtn">Back to Question</button>
      </div>
    </div>
  </div>
</div>


  <script>
    /*****************
     * YOUR GAME DATA ðŸ’—
     *
     * For $100/$200/$300:
     *  - type: "mc"
     *  - choices: ["text", ...] OR [{text:"...", img:"images/x.jpg"}, ...]
     *  - correctIndex: 0..3
     *  - (optional) clueImg: show image above question
     *  - answerBoxText: the memory text to show after answering
     *  - (optional) answerBoxImg: image shown in answer box after answering
     *
     * For $400/$500:
     *  - type: "typed"
     *  - answers: ["acceptable answer 1", "answer 2"]  (case-insensitive, punctuation-insensitive)
     *     - Use "*" to accept anything (for trick questions).
     *  - answerBoxText / answerBoxImg same as above
     ******************/
    const GAME = {
      values: [100, 200, 300, 400, 500],
      categories: [
        {
          name: "OUR DATES!",
          clues: [
            {
              type:"mc",
              q:"Where did we go for our first date?",
              choices:["Valencia Mall","Northridge","Koreatown","The Americana"],
              correctIndex:3,
              answerBoxText:"We went to The Americana on our first date! Remember getting Kuro Sushi and I would be nervous to look at you a lot? It was so awkward but it was really nice being with you!",
              answerBoxImg:"firstdatepictures.jpg"
            },
            {
              type:"mc",
              q:"What kind of drink did we have together on our home date?",
              choices:["Sharetea Boba","Calpico","Mogu Mogu","Peach soda"],
              correctIndex:2,
              answerBoxText:"We had mogu mogu! The buldak and drinks were so delicious and those candies that you recommended we get were definitely worth it! Cuddling with you afterwards was so nice, I didn't ever want to leave."
            },
            {
              type:"mc",
              q:"On which of our dates did Talitha win this prize?",
              clueImg:"ktown_prize.jpg",
              choices:["Koreatown Plaza","Little Tokyo","Newhall","Northridge"],
              correctIndex:0,
              answerBoxText:"It was at our Koreatown date! It was kind of crazy how you won that prize on your last attempt too! I hope you liked using it baby",
              answerBoxImg:"ktownspaghetti.jpg"
            },
            {
              type:"typed",
              q:"Which street was Albert not able to find on our Koreatown Date when driving back?",
              answers:["north hollywood","northhollywood"],
              answerBoxText:"I swear I couldn't find the place to turn it was a bit confusing not gonna lie, it was nice to talk about anime and the music on the way back",
              answerBoxImg:"unravel.jpg"
            },
            {
              type:"typed",
              q:"What were we wearing the first time we met again after our vacations? And what matching keychains did you get us?",
              // Keep this flexible: accept a few variants (add more if you want)
              answers:[
                "green shirt grey striped shirt fat cat keychains",
                "green shirt gray striped shirt fat cat keychains",
                "green shirt grey striped shirt matching fat cat keychains",
                "green shirt gray striped shirt matching fat cat keychains",
                "fat cat keychains"
              ],
              answerBoxText:"I was wearing a green shirt, Talitha was wearing a grey striped shirt and she got us matching fat cat keychains!",
              answerBoxImg:"keychains.png"
            },
          ],
        },
        {
          name: "BEGINNING OF US!",
          clues: [
            {
              type:"mc",
              q:"How did we start talking to each other?",
              choices:["We met on Gas","I dmed you on your Instagram story","We were paired up in Comms class","Arranged marriage"],
              correctIndex:1,
              answerBoxText:"I dmed you on instagram because you were using a nujabes song and I thought I should just honestly shoot my shot now, im glad I did baby"
            },
            {
              type:"mc",
              q:"Who said I love you first? How did it happen?",
              choices:["Albert, on the first date","Talitha, when she got back from Indonesia","Albert, on a facetime call in China","Talitha, when she met up with Albert in Japan"],
              correctIndex:2,
              answerBoxText:"I said I love you first on our facetime call in China and we were both laughing and we were hiding from the camera a lot"
            },
            {
              type:"mc",
              q:"What was the first restaurant we ever ate at together?",
              choices:["Chili's","India Kitchen","Rice and Nori","Kura Sushi"],
              correctIndex:3,
              answerBoxText:"It's Kura Sushi! It was such an awkward time to be honest and I don't think either of us were really that hungry but the rolls were good!"
            },
            {
              type:"typed",
              q:"When was our first sleep call?",
              answers:["september 9","september 9th","9/9","sep 9","sep 9th"],
              answerBoxText:"It was September 9th! I thought I wouldn't be able to sleep at all but it was nice to sleep with someone else on call."
            },
            {
              type:"typed",
              q:"Where did we have our first kiss?",
              answers:["japan"],
              answerBoxText:"Japan! Isn't that crazy? That was a very magical night and it really felt like we were in a movie together!",
              answerBoxImg:"japan1.jpg"
            },
          ],
        },
        {
          name: "ABOUT TALBERT!",
          clues: [
            {
              type:"mc",
              q:"What is our go to activity to do when we eat together?",
              choices:["Scroll on rednote","Watch youtube together","Scroll on reels","Freestyle rapping"],
              correctIndex:2,
              answerBoxText:"It's scrolling on reels! I bet we have watched over 1000 reels at this point talitha. I like how we can take a break and brainrot together sometimes."
            },
            {
              type:"mc",
              q:"What is our most commonly used pet name for each other?",
              choices:["Bubu/Dudu","Baby","Sweetie","Albie/Tawifa"],
              correctIndex:1,
              answerBoxText:"The answer is baby, my sweetie bubu cute princess tawifa bear!"
            },
            {
              type:"mc",
              q:"How many times have we called in the month of November alone?",
              choices:["328","90","42","117"],
              correctIndex:0,
              answerBoxText:"It's 328 calls! Woah that is a lot baby it feels like we know all about each other's daily lives now"
            },
            {
              type:"typed",
              q:"What is the first anniversary gift that we got each other?",
              // Accept anything (you wanted typed for 400/500, but this is basically a memory reveal)
              answers:["*"],
              answerBoxText:"I got you meiji chocolate mushrooms and hi chews and you got me an ello pop new water bottle!"
            },
            {
              type:"typed",
              q:"On our date in japan, what happened before we left each other?",
              answers:["first kiss","we shared our first kiss","kiss"],
              answerBoxText:"We shared our first kiss! It was so magical to me I was full of adrenaline and ran back to the train station afterwards baby!",
              answerBoxImg:"japan1.jpg"
            },
          ],
        },
        {
          name: "MY TALITHA!",
          clues: [
            {
              type:"mc",
              q:"Which talitha is dancing on rainbows?",
              // image choices
              choices:[
                {text:"A", img:"sillytalitha.jpg"},
                {text:"B", img:"madtalitha.jpg"},
                {text:"C", img:"suprisedtalitha.jpg"},
                {text:"D", img:"dancingrainbows.jpg"},
              ],
              correctIndex:3,
              answerBoxText:"It is this one:",
              answerBoxImg:"dancingrainbows.jpg"
            },
            {
              type:"mc",
              q:"Talitha reminds me of what kind of animal the most?",
              choices:["Walrus","Sea Lion","Seal because her eyes are precious like a seal","Frill-necked Lizard"],
              correctIndex:2,
              answerBoxText:"The answer is seal because her eyes are precious like a seal! Your eyes are so cute talitha"
            },
            {
              type:"mc",
              q:"Which one of these Talithas is the cutest?",
              choices:[
                {text:"A", img:"cutetalitha1.jpg"},
                {text:"B", img:"cuetalithha2.jpg"},
                {text:"C", img:"cutetalitha3.jpg"},
                {text:"D", img:"cutetalitha4.jpg"},
              ],
              // doesn't matterâ€”this becomes a trick reveal
              correctIndex:0,
              answerBoxText:"TRICK QUESTION! ALL OF THEM ARE THE CUTEST! TALITHA IS ALWAYS CUTE!"
            },
            {
              type:"typed",
              q:"Is my talitha super pretty, super cute, or super hot?",
              answers:["*"],
              answerBoxText:"TRICK QUESTION! MY TALITHA IS ALL OF THE ABOVE!"
            },
            {
              type:"typed",
              q:"What part of talitha's face do I love the most?",
              answers:["smile","her smile","beautiful smile"],
              answerBoxText:"The answer is her beautiful smile! It lights up my day :)"
            },
          ],
        },
        {
          name: "LOVE TO YOU!",
          clues: [
            {
              type:"mc",
              q:"What am I talking about here: We would rather not have to do this, but as long as it is with you, I would gladly choose to do it",
              choices:["Playing minecraft bedwars","Long Distance","Watching gloving reels","Eating at Cafe 3"],
              correctIndex:1,
              answerBoxText:"I would gladly choose to do long distance with you if needed baby"
            },
            {
              type:"mc",
              q:"What do I feel the most from you everyday",
              choices:["Your love and affection","Your face","Your courage","Your sexiness"],
              correctIndex:0,
              answerBoxText:"It's your love and affection! I feel it every single day talitha!"
            },
            {
              type:"mc",
              q:"How much do I love you talitha?",
              choices:["1000 Hearts","10000 Hearts","100000 Hearts","Infinite hearts"],
              correctIndex:3,
              answerBoxText:"It's Infinite hearts! My love for you is infinite!"
            },
            {
              type:"typed",
              q:"Talitha is my ____",
              answers:["*"],
              answerBoxText:"Talitha is my baby, sweetie, princess, bubu bear, babygirl, honey, wifey, lover, and amazing amazing girlfriend"
            },
            {
              type:"typed",
              q:"What is the song that started it all?",
              answers:["space between two worlds","space between two worlds by nujabes"],
              answerBoxText:"space between two worlds by nujabes"
            },
          ],
        },
      ],
    };

    /*****************
     * ENGINE
     ******************/
    const boardEl = document.getElementById("board");
    const overlay = document.getElementById("overlay");

    const clueImgEl = document.getElementById("clueImg");
    const clueText = document.getElementById("clueText");

    const metaLabel = document.getElementById("metaLabel");
    const metaTitle = document.getElementById("metaTitle");
    const scoreEl = document.getElementById("score");
    const usedCountEl = document.getElementById("usedCount");
    const totalCountEl = document.getElementById("totalCount");

    const mcArea = document.getElementById("mcArea");
    const choicesEl = document.getElementById("choices");
    const mcResult = document.getElementById("mcResult");

    const typeArea = document.getElementById("typeArea");
    const typedInput = document.getElementById("typedInput");
    const checkTypedBtn = document.getElementById("checkTypedBtn");
    const typeResult = document.getElementById("typeResult");

    const closeBtn = document.getElementById("closeBtn");
    const skipBtn = document.getElementById("skipBtn");
    const correctBtn = document.getElementById("correctBtn");
    const wrongBtn = document.getElementById("wrongBtn");
    const resetBtn = document.getElementById("resetBtn");
    const answerOverlay = document.getElementById("answerOverlay");
    const answerCloseBtn = document.getElementById("answerCloseBtn");
    const answerBackBtn = document.getElementById("answerBackBtn");
    const answerStayBtn = document.getElementById("answerStayBtn");
    
    const answerMetaLabel = document.getElementById("answerMetaLabel");
    const answerMetaTitle = document.getElementById("answerMetaTitle");
    const answerPopupTitle = document.getElementById("answerPopupTitle");
    const answerPopupText = document.getElementById("answerPopupText");
    const answerPopupImg = document.getElementById("answerPopupImg");

    const state = {
      used: new Set(),   // "c-r"
      score: 0,
      active: null,      // {c,r,value,clue,catName}
      answered: false    // lock to prevent double scoring
    };

    function money(n){
      const sign = n < 0 ? "-" : "";
      return sign + "$" + Math.abs(n).toLocaleString();
    }

    function normalize(s){
      return (s ?? "")
        .toLowerCase()
        .replace(/[^\p{L}\p{N}]+/gu, " ")
        .trim()
        .replace(/\s+/g, " ");
    }

    function updateHUD(){
      scoreEl.textContent = money(state.score);
      usedCountEl.textContent = state.used.size;
    }

    function markUsed(c, r){
      state.used.add(`${c}-${r}`);
      const tile = document.querySelector(`[data-tile="${c}-${r}"]`);
      if(tile){
        tile.classList.add("used");
        tile.textContent = "â€”";
      }
      updateHUD();
    }

    function openAnswerPopup(clue){
  // label/title can be whatever you want
  answerMetaLabel.textContent = "Answer â€¢ Memory";
  answerMetaTitle.textContent = "ðŸ’—";
  answerPopupTitle.textContent = "Answer ðŸ’—";

  answerPopupText.textContent = clue.answerBoxText ?? "";

  if(clue.answerBoxImg){
    answerPopupImg.src = clue.answerBoxImg;
    answerPopupImg.style.display = "block";
  } else {
    answerPopupImg.removeAttribute("src");
    answerPopupImg.style.display = "none";
  }

  // show popup
  answerOverlay.style.display = "flex";
  answerOverlay.classList.add("show");
}

function closeAnswerPopup(){
  answerOverlay.classList.remove("show");
  answerOverlay.style.display = "none";
}

function resetAnswerUI(){
  // clue image
  clueImgEl.style.display = "none";
  clueImgEl.removeAttribute("src");

  // areas + results
  mcArea.style.display = "none";
  typeArea.style.display = "none";

  mcResult.className = "result";
  mcResult.textContent = "";
  mcResult.style.display = "none";

  typeResult.className = "result";
  typeResult.textContent = "";
  typeResult.style.display = "none";

  typedInput.value = "";
}


    function openClue(c, r){
      const value = GAME.values[r];
      const category = GAME.categories[c];
      const clue = category.clues[r];
      state.active = { c, r, value, clue, catName: category.name };
      state.answered = false;

      metaLabel.textContent = `${category.name} â€¢ ${money(value)}`;
      metaTitle.textContent = `Clue for ${money(value)}`;
      clueText.textContent = clue.q;

      resetAnswerUI();

      // show clue image if provided
      if(clue.clueImg){
        clueImgEl.src = clue.clueImg;
        clueImgEl.style.display = "block";
      }

      if(clue.type === "mc"){
        mcArea.style.display = "flex";
        renderChoices(clue);
      } else {
        typeArea.style.display = "flex";
        setTimeout(() => typedInput.focus(), 50);
      }

      overlay.classList.add("show");
    }

    function closeModal(){
      overlay.classList.remove("show");
      state.active = null;
      state.answered = false;
    }

    function buildBoard(){
      boardEl.innerHTML = "";

      // categories row
      for(let c=0;c<GAME.categories.length;c++){
        const cat = document.createElement("div");
        cat.className = "cat";
        cat.textContent = GAME.categories[c].name;
        boardEl.appendChild(cat);
      }

      // value rows
      for(let r=0;r<GAME.values.length;r++){
        for(let c=0;c<GAME.categories.length;c++){
          const t = document.createElement("div");
          t.className = "tile";
          t.textContent = money(GAME.values[r]);
          t.dataset.tile = `${c}-${r}`;

          if(state.used.has(`${c}-${r}`)) t.classList.add("used");

          t.addEventListener("click", () => {
            if (t.classList.contains("used")) return;
            openClue(c, r);
          });

          boardEl.appendChild(t);
        }
      }

      totalCountEl.textContent = GAME.categories.length * GAME.values.length;
      updateHUD();
    }

    function renderChoices(clue){
      choicesEl.innerHTML = "";

      clue.choices.forEach((choice, idx) => {
        const isObj = typeof choice === "object" && choice !== null;
        const labelText = isObj ? (choice.text ?? "") : String(choice);
        const imgPath = isObj ? choice.img : null;

        const b = document.createElement("button");
        b.className = "choiceBtn";

        const left = document.createElement("div");
        left.style.fontWeight = "950";
        left.style.minWidth = "30px";
        left.textContent = String.fromCharCode(65 + idx) + ".";

        b.appendChild(left);

        if(imgPath){
          const img = document.createElement("img");
          img.className = "choiceThumb";
          img.alt = "Choice image";
          img.src = imgPath;
          b.appendChild(img);
        }

        const textWrap = document.createElement("div");
        textWrap.textContent = imgPath ? "" : labelText; // if image-choice, letter is enough
        if(imgPath){
          textWrap.style.color = "var(--muted)";
          textWrap.style.fontWeight = "850";
          textWrap.textContent = "(image choice)";
        }
        b.appendChild(textWrap);

        b.addEventListener("click", () => handleMCAnswer(idx));
        choicesEl.appendChild(b);
      });
    }

    function handleMCAnswer(chosenIdx){
      if(!state.active || state.answered) return;
      const { clue, value, c, r } = state.active;

      state.answered = true;
      const correct = chosenIdx === clue.correctIndex;

      // style buttons + disable
      [...choicesEl.children].forEach((btn, idx) => {
        btn.disabled = true;
        if(idx === clue.correctIndex) btn.classList.add("correct");
        if(idx === chosenIdx && !correct) btn.classList.add("wrong");
      });

      // result banner
      mcResult.style.display = "block";
      mcResult.classList.add("show", correct ? "ok" : "bad");
      mcResult.textContent = correct ? `Correct! +${money(value)}` : `Not quiteâ€¦ ${money(-value)}`;

      // score + mark used
      markUsed(c, r);
      state.score += correct ? value : -value;
      updateHUD();

      // show answer box
      openAnswerPopup(clue);

    }

    function tokens(s){
  return normalize(s).split(" ").filter(Boolean);
}

// returns true if *every keyword* in `pattern` appears somewhere in `guess`
function keywordMatch(guess, pattern){
  const g = new Set(tokens(guess));
  const p = tokens(pattern);

  // if pattern is empty, don't match
  if(p.length === 0) return false;

  // require all tokens from pattern to appear in guess
  return p.every(w => g.has(w));
}

function handleTypedCheck(){
  if(!state.active || state.answered) return;
  const { clue, value, c, r } = state.active;

  const guessRaw = typedInput.value || "";
  const guess = normalize(guessRaw);

  const acceptableRaw = (clue.answers ?? []);
  const acceptable = acceptableRaw.map(normalize).filter(Boolean);

  const wildcard = acceptable.includes("*");

  // âœ… KEYWORD-BASED:
  // correct if ANY acceptable pattern's keywords are all contained in guess
  const correct = wildcard
    ? true
    : acceptable.some(pattern => keywordMatch(guess, pattern));

  typeResult.style.display = "block";
  typeResult.classList.add("show", correct ? "ok" : "bad");

  if(correct){
    typeResult.textContent = `Correct! +${money(value)}`;
    state.answered = true;
    markUsed(c, r);
    state.score += value;
    updateHUD();
  } else {
    typeResult.textContent = `Not matched (keyword check). You can still mark Correct/Wrong manually below if you want.`;
  }

  // always show the memory/answer box after checking
  openAnswerPopup(clue);

}


    // Manual scoring buttons (works especially for typed if you want flexibility)
    function resolveManual(correct){
      if(!state.active) return;
      const { c, r, value, clue } = state.active;

      // prevent double scoring
      if(state.used.has(`${c}-${r}`)){
        closeModal();
        return;
      }

      markUsed(c, r);
      state.score += correct ? value : -value;
      updateHUD();

      // show answer box too (so you still see the memory)
      openAnswerPopup(clue);

    }

    // Controls
    checkTypedBtn.addEventListener("click", handleTypedCheck);
    typedInput.addEventListener("keydown", (e) => {
      if(e.key === "Enter") handleTypedCheck();
    });
  
    correctBtn.addEventListener("click", () => resolveManual(true));
    wrongBtn.addEventListener("click", () => resolveManual(false));

    closeBtn.addEventListener("click", closeModal);
    skipBtn.addEventListener("click", closeModal);

    overlay.addEventListener("click", (e) => {
      if(e.target === overlay) closeModal();
    });

    resetBtn.addEventListener("click", () => {
      state.used.clear();
      state.score = 0;
      closeModal();
      buildBoard();
    });
    answerCloseBtn.addEventListener("click", closeAnswerPopup);
    
    // Back to Board: close both popups
    answerBackBtn.addEventListener("click", () => {
      closeAnswerPopup();
      closeModal(); // closes the question modal
    });
    
    // Back to Question: close answer popup only
    answerStayBtn.addEventListener("click", () => {
      closeAnswerPopup();
    });
    
    // click outside closes answer popup
    answerOverlay.addEventListener("click", (e) => {
      if(e.target === answerOverlay) closeAnswerPopup();
    });

    // Start
    buildBoard();
  </script>
</body>
</html>
